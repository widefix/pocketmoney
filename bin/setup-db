#!/bin/bash
# Database setup script for production deployment

set -e

echo "Waiting for PostgreSQL to be ready..."
until bundle exec rails runner "ActiveRecord::Base.connection.execute('SELECT 1')" &> /dev/null; do
  echo "PostgreSQL is unavailable - sleeping"
  sleep 2
done

echo "PostgreSQL is ready!"

echo "Creating database if it doesn't exist..."
bundle exec rails db:create

echo "Running database migrations..."
bundle exec rails db:migrate

echo "Database setup completed!"